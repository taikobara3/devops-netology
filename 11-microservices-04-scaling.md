# Домашнее задание к занятию «Микросервисы: масштабирование»


Вы работаете в крупной компании, которая строит систему на основе микросервисной архитектуры.
Вам как DevOps-специалисту необходимо выдвинуть предложение по организации инфраструктуры для разработки и эксплуатации.

## Задача 1: Кластеризация

Предложите решение для обеспечения развёртывания, запуска и управления приложениями.
Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципgggы их взаимодействия.

Решение должно соответствовать следующим требованиям:
- поддержка контейнеров;
- обеспечивать обнаружение сервисов и маршрутизацию запросов;
- обеспечивать возможность горизонтального масштабирования;
- обеспечивать возможность автоматического масштабирования;
- обеспечивать явное разделение ресурсов, доступных извне и внутри системы;
- обеспечивать возможность конфигурировать приложения с помощью переменных среды, в том числе с возможностью безопасного хранения чувствительных данных таких как пароли, ключи доступа, ключи шифрования и т. п.

Обоснуйте свой выбор.


|                                                                                                                    | Kubernetes                                                                           | Docker Swarm                                                 | Rancer                          | Nomad                                                | OpenShift                                                                                                                                                                                                                                                                                                                             | Apache Mesos | Fleet       |
|--------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------|--------------------------------------------------------------|---------------------------------|------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------| --- |-------------|
| **Поддержка контейнеров**                                                                                          | OCI совместимые, включая Docker                                                      | Только Docker                                                | OCI совместимые, включая Docker | OCI совместимые, включая Docker, LXC, systemd-nspawn | OCI совместимые, включая Docker                                                                                                                                                                                                                                                                                                       | Да | Да          |
| **Oбнаружение сервисов и маршрутизация запросов**                                                                  | Да                                                                                   | Да                                                           | Да                              | Нет (необходим дополнительный Consul)                | Да                                                                                                                                                                                                                                                                                                                                    | Да | ?           |
| **Возможность горизонтального масштабирования**                                                                    | Да                                                                                   | Да                                                           | Да                              | Да                                                   | Да                                                                                                                                                                                                                                                                                                                                    | Да | Ограниченно |
| **Возможность автоматического масштабирования**                                                                    | Вертикально и горизонтально                                                          | Нет                                                          | Вертикально и горизонтально     | Вертикально (в Enteprise версии) и горизонтально     | Вертикально и горизонтально                                                                                                                                                                                                                                                                                                           |Да | ?           |
| **Явное разделение ресурсов доступных извне и внутри системы**                                                     | Да (извне - Services, изнутри - Namespaces)                                          | Да (извне - publish, изнутри - overlay network внутри swarm) | Да                              | Да                                                   | Да | Да | Нет         |
| **Возможность конфигурировать приложения с помощью переменных среды**                                              | Да                                                                                   | Да                                                           | Да                              | Да                                                   | Да                                                                                                                                                                                                                                          |Да | Да          |
| **Возможность безопасного хранения чувствительных данных таких как пароли, ключи доступа, ключи шифрования и т.п** | Да | Да                                          | Да                              | Нет, только сторонние (Vault)                        | Да | Да | Нет         |                                                                                                                                                                                                                                          | Да | ? |

В вышеприведенной таблице кратко представлены основные характеристики различных систем оркестрации, применительно к целям, поставленным в задаче.

OpenShift имеет в своей основе Kubernetis, имеет в своем составе неплохую систему мониторинга и логирования работы контейнеров, но привязана к дистрибутиву Red Hat

Runcher также построен на Kubernetis, хорошо работает с разнородными кластерами, имеет в своем составе систему централизованной аутентификации

Nomad, в отличии от двух предыдыущих - более простая система оркестрации, которая, однако, может работать не только с контейнерами, но и с обычными приложениями, привязана к другим приложениям HashiCorp, языку HCL, обладает несколько большей производительностью, чем Kubernetis

Docker Swarm - более простая и ограниченная, но в то же время более доступная (Входит в состав Docker). Хорошо подходит для небольших проектов. Преимуществом можно считать, то, что Swarm нативно использует docker-compose файлы

Apache Mesos - более производительная, чем Kubernetis система оркестрации (изначально заточена на Big Data), но более сложная в администрировании, поддерживает и неконтейнерные приложения

Fleet - весьма простой в настройке и поддержке универсальный (контейнеры и обычные приложения) оркестратор, с несколько ограниченной функциональностью. В настоящее время не поддерживается.

Таким образом, для достижения целей, поставленных в задаче, я бы использовал Kubernetis, как вполне самодостаточную систему оркестрации, отвечающую всем требованиям.
Более удобным вариантом Kubernetis является, OpenShift. У OpenShift есть ряд преимуществ, но это коммерческий продукт, со всеми вытекающими из этого последствиями. Также он привязан к использованию ОС семейства Red Hat. 